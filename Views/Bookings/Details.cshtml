@model TravelAgency.Models.Booking
@using TravelAgency.Models

@{
    ViewData["Title"] = "Booking Details";

    bool canCancel =
        Model.Status == BookingStatus.PendingPayment ||
        (Model.Status == BookingStatus.Confirmed &&
         DateTime.Today <= Model.CancellationAllowedUntil.Date);

    var imageUrl = Model.TravelPackage.Images.FirstOrDefault()?.ImageUrl
        ?? "/images/trips/placeholder.jpg";
}

<h2 class="mb-3">Booking Details</h2>

<!-- TRIP IMAGE -->
<div class="mb-4">
    <img src="@imageUrl"
         class="img-fluid rounded shadow-sm w-100"
         style="max-height: 420px; object-fit: cover;"
         alt="@Model.TravelPackage.Name" />
</div>

<div class="card p-4 shadow-sm">

    <h4 class="mb-3">@Model.TravelPackage.Name</h4>

    <p>
        <strong>Dates:</strong>
        @Model.DepartureDate.ToString("dd MMM yyyy")
        –
        @Model.TravelPackage.EndDate.ToString("dd MMM yyyy")
    </p>

    <p>
        <strong>Total:</strong>
        €@Model.TotalPrice
    </p>

    <p>
        <strong>Status:</strong>
        <span class="badge
            @(Model.Status == BookingStatus.Confirmed ? "bg-success" :
              Model.Status == BookingStatus.PendingPayment ? "bg-warning text-dark" :
              "bg-secondary")">
            @Model.Status
        </span>
    </p>

    <p class="text-muted">
        Booked on @Model.BookingDate.ToString("dd MMM yyyy")
    </p>

    <!-- ACTIONS -->
    <div class="mt-4 d-flex gap-2 flex-wrap">

        @if (Model.Status == BookingStatus.PendingPayment)
        {
            <a asp-controller="Payments"
               asp-action="Pay"
               asp-route-bookingId="@Model.Id"
               class="btn btn-danger">
                Pay Now
            </a>
        }

        @if (canCancel)
        {
            <form asp-action="Cancel" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.Id" />
                <button class="btn btn-outline-danger">
                    Cancel Booking
                </button>
            </form>
        }

        @if (Model.Status == BookingStatus.Confirmed)
        {
            <a asp-action="DownloadItinerary"
               asp-route-id="@Model.Id"
               class="btn btn-outline-primary">
                Download Itinerary
            </a>
        }
    </div>

    <a asp-action="MyBookings" class="btn btn-secondary mt-4">
        Back to My Bookings
    </a>

</div>
